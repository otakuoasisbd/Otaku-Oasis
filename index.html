<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Otaku Oasis - Shop</title>
  <link rel="icon" type="image/png" href="assets/otaku logo main.png">
  <meta name="description" content="Otaku Oasis ‚Äî anime collectibles & figures." />
  <style>
    :root{
      --bg:#07060b;
      --card:#0d0d12;
      --muted:#9aa0a6;
      --accent1:#ff2d6f;
      --accent2:#7b5cff;
      --glass: rgba(255,255,255,0.04);
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg),#060409);color:#e9eef8}
    .wrap{max-width:1200px;margin:26px auto;padding:18px}
    h1{font-size:28px;margin:6px 0 18px;color:var(--accent2)}
    .section-title{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px}
    .card{background:linear-gradient(180deg,#0b0b0f,var(--card));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);position:relative;overflow:hidden;cursor:default}
    .thumb{height:220px;border-radius:10px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));margin-bottom:10px}
    .thumb img{max-width:100%;max-height:100%;display:block;transition:transform .4s ease}
    .card h4{margin:6px 0;font-size:16px}
    .price{font-weight:900;color:var(--accent1)}
    .desc{color:var(--muted);font-size:13px;margin:8px 0}
    .btn-row{display:flex;gap:8px}
    .btn{flex:1;padding:10px;border-radius:10px;text-align:center;text-decoration:none;font-weight:800;border:none;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#05060a}
    .btn.ghost{border:1px solid rgba(255,255,255,0.06);color:var(--muted);background:transparent}
    .badge{position:absolute;left:12px;top:12px;padding:6px 8px;border-radius:10px;font-weight:800;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#05060a;font-size:12px}
    /* floating cart (shopping bag) */
    .cart-bubble{position:fixed; right:18px; bottom:18px; z-index:1200; background:linear-gradient(180deg,var(--accent1),var(--accent2)); color:#05060a;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);font-weight:800;cursor:pointer;display:flex;align-items:center;gap:10px;box-shadow:0 14px 36px rgba(0,0,0,0.5)}
    .cart-count{background:#05060a;color:#fff;padding:6px 8px;border-radius:8px;font-weight:900}
    /* cart popup */
    .cart-popup{position:fixed; right:18px; bottom:86px; z-index:1300; width:360px; display:none; background:linear-gradient(180deg,#0b0b10,#0a0a0d);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 20px 60px rgba(0,0,0,0.6)}
    .cart-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dotted rgba(255,255,255,0.03)}
    .small{font-size:13px;color:var(--muted)}
    /* modal for details */
    #modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;padding:20px;z-index:1400}
    #modal.open{display:flex}
    .modal-card{max-width:1000px;width:100%;background:linear-gradient(180deg,#0d0d12,#0b0b0f);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03);display:grid;grid-template-columns:1fr 360px;gap:18px}
    .modal-img{width:100%;height:420px;border-radius:10px;object-fit:contain;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));cursor:pointer}
    .thumb-strip{display:flex;gap:8px;overflow:auto;padding-top:6px}
    .thumb-strip img{height:64px;border-radius:8px;cursor:pointer;opacity:.8;border:2px solid transparent}
    .thumb-strip img.active{opacity:1;border-color:var(--accent2)}
    .modal-close{position:absolute;right:18px;top:12px;font-size:26px;color:#fff;background:transparent;border:none;cursor:pointer}
    @media(max-width:980px){ .modal-card{grid-template-columns:1fr} .modal-img{height:300px} .cart-popup{width:92vw; right:4vw} }
  </style>
</head>
<body>
  <div class="wrap">
    <header style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
      <img src="assets/wb otaku.PNG" alt="logo" style="height:52px;border-radius:10px">
      <div>
        <h1 style="margin:0">Otaku Oasis ‚Äî Shop & Pre-orders</h1>
        <div class="small">Anime figures & collectibles</div>
      </div>
    </header>

    <!-- SHOP SECTION -->
    <section id="shop-section">
      <div class="section-title">
        <h2 style="margin:0;color:var(--accent2)">Shop</h2>
        <div class="small">Auto-shuffles products & photos every few seconds</div>
      </div>
      <div class="grid" id="products-grid" role="list" aria-live="polite"></div>
    </section>

    <!-- PREORDERS SECTION -->
    <section id="preorders-section" style="margin-top:30px">
      <div class="section-title">
        <h2 style="margin:0;color:var(--accent2)">Pre-orders</h2>
        <div class="small">Pre-order items ‚Äî reserve limited-run pieces</div>
      </div>
      <div class="grid" id="preorders-grid" role="list" aria-live="polite"></div>
    </section>
  </div>

  <!-- floating shopping bag -->
  <button class="cart-bubble" id="cartBubble" aria-haspopup="dialog" title="Open cart">
    üõçÔ∏è <span id="cartLabel" style="font-weight:800">Cart</span>
    <span class="cart-count" id="cartCount">0</span>
  </button>

  <!-- cart popup -->
  <div class="cart-popup" id="cartPopup" role="dialog" aria-modal="true" aria-label="Cart">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Cart</strong>
      <button onclick="toggleCart()" style="background:transparent;border:none;color:var(--muted);cursor:pointer;font-size:18px">√ó</button>
    </div>
    <div id="cartItems" style="margin-top:8px;max-height:260px;overflow:auto"></div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn primary" id="checkoutBtn" style="flex:1">Checkout</button>
      <button class="btn ghost" onclick="clearCart()" style="flex:1">Clear</button>
    </div>
  </div>

  <!-- modal for quick-view -->
  <div id="modal" aria-hidden="true">
    <button class="modal-close" onclick="closeModal()" aria-label="Close modal">&times;</button>
    <div class="modal-card" role="dialog" aria-label="Product details">
      <div style="display:flex;flex-direction:column">
        <img id="modal-img" class="modal-img" src="" alt="" loading="lazy">
        <div class="thumb-strip" id="modal-thumbs" aria-hidden="false"></div>
      </div>
      <div>
        <h3 id="modal-title" style="margin:0;color:var(--accent1)"></h3>
        <div class="small" id="modal-caption" style="margin-top:8px"></div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <!-- Add to Cart -->
          <button id="modalAddCart" class="btn primary">Add to Cart</button>
          <!-- Buy Now -->
          <button id="modalBuyNow" class="btn ghost">Buy Now</button>
        </div>
        <div style="margin-top:12px;color:var(--muted)" id="modal-extra">Click main image to cycle photos; use ‚Üê ‚Üí or Esc to close.</div>
      </div>
    </div>
  </div>

  <script>
    /************************************************************************
     * Configuration & data - EDIT THESE ARRAYS to add/remove products easily
     ************************************************************************/
    const MESSENGER_BASE = "https://www.facebook.com/messages/t/737804756085179";
    // Main shop products (images placed in assets/)
    const products = [
      {id:'akaza1', name:'Akaza', priceText:'700tk', price:700, imgs:['assets/akaza1.JPEG','assets/akaza2.JPEG','assets/akaza3.JPEG'], desc:'Akaza figure Size:28cm from Demon Slayer.', category:'Demon Slayer'},
      {id:'marin', name:'Marin Kitagawa', priceText:'800tk', price:800, imgs:['assets/marin1.JPEG','assets/marin2.JPEG','assets/marin3.JPEG'], desc:'Limited edition Marin figure from My Dressup Darling with box.', category:'Other'},
      {id:'tanjiro', name:'Tanjiro', priceText:'800tk', price:800, imgs:['assets/tanjiro1.JPG','assets/tanjiro2.JPG','assets/tanjiro3.JPG'], desc:'Tanjiro Kamado Size:28cm from Demon Slayer.', category:'Demon Slayer'},
      {id:'makima', name:'Bunny Makima', priceText:'2000tk', price:2000, imgs:['assets/makima1.jpeg','assets/makima2.jpeg','assets/makima3.jpeg'], desc:'Original Furyu Makima figure Size:28cm from Chainsawman with box.', category:'Chainsawman'},
      {id:'rem', name:'Rem', priceText:'600tk', price:600, imgs:['assets/rem1.jpg','assets/rem2.JPEG','assets/rem3.jpg'], desc:'Rem figure Size:28cm from Re:Zero.', category:'Other'},
      {id:'tohka', name:'Tohka Yatogami', priceText:'800tk', price:800, imgs:['assets/tohka1.jpg','assets/tohka2.jpg','assets/tohka3.jpg'], desc:'Tohka Yatogami figure Size:28cm from Date a Live Girl.', category:'Other'},
      {id:'chibi-duo', name:'Chibi Nezuko & Zenitsu', priceText:'500tk', price:500, imgs:['assets/zenitsu.small.jpg','assets/nezuko.small.jpg'], desc:'Chibi cute Zenitsu & Nezuko figure Size:8cm from Demon Slayer.', category:'Demon Slayer'}
    ];

    // Preorders (same structure, keep images in assets/)
    const preorders = [
      {id:'sailormoon', title:'Sailor Moon - Limited', priceText:'TBD', eta:'2026-01', imgs:['assets/sailor1.jpg','assets/sailor2.jpg'], note:'Reserve now, limited run.'},
      {id:'jujutsuset', title:'Jujutsu Kaisen Set', priceText:'Bundle', eta:'2025-12', imgs:['assets/jujutsu1.jpg','assets/jujutsu2.jpg'], note:'Bundle pre-order discount.'}
    ];

    /************************************************************************
     * Small helpers
     ************************************************************************/
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    /* ======= cart (localStorage) ======= */
    function getCart(){ try { return JSON.parse(localStorage.getItem('oo_cart')||'[]'); } catch(e){ return []; } }
    function saveCart(c){ localStorage.setItem('oo_cart', JSON.stringify(c)); updateCartCount(); renderCart(); }
    function addToCartItem(item){
      const cart = getCart();
      const found = cart.find(i=>i.id===item.id);
      if(found) found.qty = (found.qty||1) + 1;
      else cart.push({id:item.id, name:item.name || item.title, priceText:item.priceText || item.priceText || '', qty:1});
      saveCart(cart);
    }
    function clearCart(){ localStorage.removeItem('oo_cart'); renderCart(); updateCartCount(); }
    function renderCart(){
      const container = $('#cartItems');
      const cart = getCart();
      container.innerHTML = '';
      if(!cart.length){ container.innerHTML = '<div class="small">Cart is empty</div>'; return; }
      cart.forEach(item=>{
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `<div>
            <strong style="font-size:14px">${item.name}</strong>
            <div class="small">${item.priceText} √ó ${item.qty}</div>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button class="btn ghost" style="padding:6px 8px" onclick="decreaseQty('${item.id}')">‚Äì</button>
            <button class="btn ghost" style="padding:6px 8px" onclick="increaseQty('${item.id}')">+</button>
          </div>`;
        container.appendChild(div);
      });
    }
    function decreaseQty(id){
      const cart = getCart();
      const item = cart.find(i=>i.id===id);
      if(!item) return;
      item.qty--; if(item.qty<=0) { const idx = cart.findIndex(i=>i.id===id); cart.splice(idx,1); }
      saveCart(cart);
    }
    function increaseQty(id){
      const cart = getCart(); const item = cart.find(i=>i.id===id);
      if(!item) return; item.qty++; saveCart(cart);
    }
    function updateCartCount(){
      const c = getCart().reduce((s,i)=>s+i.qty,0);
      $('#cartCount').textContent = c;
    }

    /* ======= rendering products/preorders ======= */
    const productsGrid = $('#products-grid');
    const preordersGrid = $('#preorders-grid');

    // Render a product card (shop)
    function makeProductCard(p){
      const card = document.createElement('article');
      card.className = 'card';
      card.setAttribute('role','listitem');
      // show "Hot" badge if price < 700 (example)
      const badge = (p.price && p.price < 700) ? `<div class="badge">Hot</div>` : '';
      // initial image (first of imgs)
      const imgSrc = (p.imgs && p.imgs.length) ? p.imgs[0] : 'assets/placeholder.png';
      card.innerHTML = `
        ${badge}
        <div class="thumb"><img loading="lazy" src="${imgSrc}" alt="${p.name}"></div>
        <h4>${p.name}</h4>
        <div class="price">${p.priceText}</div>
        <div class="desc">${p.desc}</div>
        <div class="btn-row">
          <button class="btn primary" data-id="${p.id}" data-action="add">Add to Cart</button>
          <button class="btn ghost" data-id="${p.id}" data-action="buy">Buy</button>
          <button class="btn ghost" data-id="${p.id}" data-action="details">Details</button>
        </div>
      `;
      // add image cycling on the card
      if(p.imgs && p.imgs.length > 1){
        let idx = 0;
        setInterval(()=>{
          idx = (idx + 1) % p.imgs.length;
          const img = card.querySelector('.thumb img');
          img.src = p.imgs[idx];
        }, 4200 + (Math.random()*2500)); // each card cycles slightly differently
      }
      // button handlers
      card.querySelectorAll('[data-action]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const action = e.currentTarget.getAttribute('data-action');
          const id = e.currentTarget.getAttribute('data-id');
          const product = products.find(x=>x.id===id);
          if(action === 'add') { addToCartItem(product); humConfetti(); }
          if(action === 'buy') { openMessengerForProduct(product); }
          if(action === 'details') { showDetails(product); }
        });
      });
      // clicking image opens details
      card.querySelector('.thumb img').addEventListener('click', ()=> showDetails(p));
      return card;
    }

    // Render pre-order card (same structure but uses title & note)
    function makePreorderCard(p){
      const card = document.createElement('article');
      card.className = 'card';
      card.setAttribute('role','listitem');
      const imgSrc = (p.imgs && p.imgs.length) ? p.imgs[0] : 'assets/placeholder.png';
      card.innerHTML = `
        <div class="thumb"><img loading="lazy" src="${imgSrc}" alt="${p.title}"></div>
        <h4>${p.title}</h4>
        <div class="price">${p.priceText} <span style="font-weight:600;color:var(--muted);font-size:12px"> ‚Ä¢ ETA: ${p.eta}</span></div>
        <div class="desc">${p.note}</div>
        <div class="btn-row">
          <button class="btn primary" data-id="${p.id}" data-action="addpre">Add to Cart</button>
          <button class="btn ghost" data-id="${p.id}" data-action="buypre">Buy</button>
          <button class="btn ghost" data-id="${p.id}" data-action="detailspre">Details</button>
        </div>
      `;
      // cycle images for preorder
      if(p.imgs && p.imgs.length > 1){
        let idx = 0;
        setInterval(()=>{
          idx = (idx + 1) % p.imgs.length;
          const img = card.querySelector('.thumb img');
          img.src = p.imgs[idx];
        }, 4800 + (Math.random()*2600));
      }
      card.querySelectorAll('[data-action]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const action = e.currentTarget.getAttribute('data-action');
          const id = e.currentTarget.getAttribute('data-id');
          const preorder = preorders.find(x=>x.id===id);
          if(action === 'addpre'){ addToCartItem(preorder); humConfetti(); }
          if(action === 'buypre'){ openMessengerForPreorder(preorder); }
          if(action === 'detailspre'){ showPreorderDetails(preorder); }
        });
      });
      card.querySelector('.thumb img').addEventListener('click', ()=> showPreorderDetails(p));
      return card;
    }

    // initial render functions
    function renderProductsList(list, container){
      container.innerHTML = '';
      list.forEach(p => container.appendChild(makeProductCard(p)));
    }
    function renderPreordersList(list, container){
      container.innerHTML = '';
      list.forEach(p => container.appendChild(makePreorderCard(p)));
    }

    /* ======= shuffle helpers ======= */
    function shuffleArray(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }
    // shuffle and re-render both sections
    function autoShuffleAll(){
      shuffleArray(products);
      shuffleArray(preorders);
      renderProductsList(products, productsGrid);
      renderPreordersList(preorders, preordersGrid);
    }

    /* ======= modal (product details) ======= */
    let currentModalProduct = null;
    let modalIndex = 0;
    let modalTimer = null;

    function showDetails(product){
      currentModalProduct = product;
      modalIndex = 0;
      updateModalContent();
      openModal();
    }
    function showPreorderDetails(pre){
      currentModalProduct = pre;
      modalIndex = 0;
      updateModalContent(true);
      openModal();
    }
    function updateModalContent(isPre=false){
      const imgs = currentModalProduct.imgs || [];
      $('#modal-img').src = imgs[modalIndex] || 'assets/placeholder.png';
      $('#modal-img').alt = (currentModalProduct.name || currentModalProduct.title || '');
      $('#modal-title').textContent = (currentModalProduct.name || currentModalProduct.title) + (currentModalProduct.priceText ? ' ‚Äî '+currentModalProduct.priceText : '');
      $('#modal-caption').textContent = (currentModalProduct.desc || currentModalProduct.note || '');
      // set modal add to cart & buy actions
      $('#modalAddCart').onclick = ()=>{
        addToCartItem(currentModalProduct);
        humConfetti();
      };
      $('#modalBuyNow').onclick = ()=>{
        if(isPre) openMessengerForPreorder(currentModalProduct);
        else openMessengerForProduct(currentModalProduct);
      };
      // thumbs:
      const strip = $('#modal-thumbs'); strip.innerHTML = '';
      imgs.forEach((s,i)=> {
        const im = document.createElement('img');
        im.src = s; im.loading = 'lazy'; im.alt = (currentModalProduct.name || currentModalProduct.title) + ' ' + (i+1);
        if(i===modalIndex) im.classList.add('active');
        im.addEventListener('click', ()=> { modalIndex = i; updateModalContent(isPre); });
        strip.appendChild(im);
      });
    }
    function openModal(){ $('#modal').classList.add('open'); $('#modal').setAttribute('aria-hidden','false'); startModalAutoplay(); window.addEventListener('keydown', modalKeyHandler); }
    function closeModal(){ $('#modal').classList.remove('open'); $('#modal').setAttribute('aria-hidden','true'); stopModalAutoplay(); window.removeEventListener('keydown', modalKeyHandler); }
    function modalKeyHandler(e){ if(e.key==='Escape') closeModal(); if(e.key==='ArrowRight') { modalIndex=(modalIndex+1)%(currentModalProduct.imgs.length); updateModalContent(); } if(e.key==='ArrowLeft') { modalIndex=(modalIndex-1+currentModalProduct.imgs.length)%currentModalProduct.imgs.length; updateModalContent(); } }
    function startModalAutoplay(){ stopModalAutoplay(); modalTimer = setInterval(()=>{ modalIndex = (modalIndex + 1) % (currentModalProduct.imgs.length||1); updateModalContent(); }, 3500); }
    function stopModalAutoplay(){ if(modalTimer){ clearInterval(modalTimer); modalTimer = null; } }

    /* ======= messenger helpers ======= */
    function openMessengerForProduct(p){
      const details = `${p.name} ‚Äî ${p.priceText} ‚Ä¢ ${p.desc || ''}`;
      const text = encodeURIComponent(`I want to buy #${details}#`);
      window.open(`${MESSENGER_BASE}?text=${text}`, '_blank');
    }
    function openMessengerForPreorder(p){
      const details = `${p.title} ‚Äî ${p.priceText} ‚Ä¢ ETA: ${p.eta} ‚Ä¢ ${p.note || ''}`;
      const text = encodeURIComponent(`I want to buy #${details}#`);
      window.open(`${MESSENGER_BASE}?text=${text}`, '_blank');
    }
    // Checkout: gather cart contents and open messenger
    function checkout(){
      const cart = getCart();
      if(!cart.length){ alert('Your cart is empty'); return; }
      const lines = cart.map(i => `${i.name} ‚Äî ${i.priceText} √ó ${i.qty}`);
      const body = `I want to buy the following items:\n\n${lines.join('\n')}\n\nPlease confirm.`;
      const text = encodeURIComponent(body);
      // open messenger
      window.open(`${MESSENGER_BASE}?text=${text}`, '_blank');
    }

    /* ======= UI controls: cart bubble popup ======= */
    const cartBubble = $('#cartBubble');
    const cartPopup = $('#cartPopup');
    cartBubble.addEventListener('click', ()=> toggleCart());
    function toggleCart(){
      if(cartPopup.style.display === 'block'){ cartPopup.style.display = 'none'; } else { renderCart(); cartPopup.style.display = 'block'; }
    }
    // close cart clicking outside
    document.addEventListener('click', (e)=>{
      if(!cartPopup.contains(e.target) && !cartBubble.contains(e.target)) cartPopup.style.display = 'none';
    });

    // attach checkout button
    $('#checkoutBtn').addEventListener('click', checkout);

    /* ======= small UX helpers ======= */
    function humConfetti(){
      const colors = ['#ff2d6f','#7b5cff','#1fe0d6','#ffd166'];
      for(let i=0;i<14;i++){
        const el = document.createElement('div');
        el.style.position='fixed'; el.style.left = (50 + (Math.random()-0.5)*40) + '%';
        el.style.top = (40 + (Math.random()-0.5)*20) + '%';
        el.style.width = el.style.height = (6 + Math.random()*8) + 'px';
        el.style.background = colors[Math.floor(Math.random()*colors.length)];
        el.style.borderRadius = (Math.random()>0.5 ? '2px' : '50%'); el.style.zIndex = 99999; el.style.pointerEvents='none';
        document.body.appendChild(el);
        const dx = (Math.random()-0.5)*200; const dy = -200 - Math.random()*400;
        el.animate([{ transform: 'translateY(0) scale(1)', opacity:1 }, { transform: `translate(${dx}px, ${dy}px) scale(.6)`, opacity:0 }], { duration: 900 + Math.random()*700, easing: 'cubic-bezier(.2,.8,.2,1)'});
        setTimeout(()=> el.remove(), 1800);
      }
    }

    /* ======= initialization & auto-shuffle timers ======= */
    // Initial render (random order)
    autoShuffleAll();
    updateCartCount();
    renderCart();

    // Auto shuffle product order every X seconds (change interval here)
    const SHUFFLE_INTERVAL_MS = 8000; // shuffle every 8s (you can change)
    setInterval(() => {
      autoShuffleAll();
    }, SHUFFLE_INTERVAL_MS);

    // ensure images that error gracefully degrade
    window.addEventListener('error', (e) => {
      if(e && e.target && e.target.tagName === 'IMG'){ e.target.src = 'assets/placeholder.png'; e.target.style.opacity = '.18'; }
    }, true);

    // expose some functions for debugging (optional)
    window.addToCartItem = addToCartItem;
    window.clearCart = clearCart;
    window.checkout = checkout;
    window.showDetails = showDetails;
    window.updateCartCount = updateCartCount;
  </script>
</body>
</html>
